generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// 1. LISTA DE BANCOS ACEITOS
// Aqui definimos as opÃ§Ãµes que o sistema vai ter
enum ProvedorPagamento {
  MERCADOPAGO
  INTER
  ASAAS
  PAGBANK
}

// --- TABELA PAI (A Barbearia/Loja) ---
model Estabelecimento {
  id                 String   @id @default(cuid())
  slug               String   @unique 
  nome               String   

  // --- SELETOR DE BANCO (NOVO!) ---
  // Define quem manda nessa loja. O padrÃ£o continua Mercado Pago.
  provedor           ProvedorPagamento @default(MERCADOPAGO)

  // --- CREDENCIAIS FINANCEIRAS ---
  
  // ðŸŸ¡ Mercado Pago (Simples)
  mercadoPagoToken   String?  

  // ðŸŸ  Banco Inter (SeguranÃ§a BancÃ¡ria - Certificados)
  interClientId      String?
  interClientSecret  String?
  interCert          String?  @db.Text // O arquivo .crt (Texto Gigante)
  interKey           String?  @db.Text // O arquivo .key (Texto Gigante)

  // ðŸ”µ Asaas (Preparado para o futuro)
  asaasToken         String?
  asaasWalletId      String?

  // ðŸŸ¢ PagBank (Preparado para o futuro)
  pagbankToken       String?
  
  // --- PERSONALIZAÃ‡ÃƒO VISUAL ---
  logoUrl            String?  
  backgroundImageUrl String?  
  corPrincipal       String   @default("#acb9b5") 
  
  // --- CONTATO & RODAPÃ‰ ---
  telefoneWhatsApp   String?  
  endereco           String?  
  
  // --- REGRAS DE NEGÃ“CIO ---
  porcentagemSinal   Float    @default(50.0) 
  horarioAbertura    String   @default("08:00")
  horarioFechamento  String   @default("20:00")
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // --- RELAÃ‡Ã•ES ---
  agendamentos       Agendamento[]
  servicos           Service[]
}

// --- AGENDAMENTOS ---
model Agendamento {
  id              String   @id @default(cuid())
  slug            String?
  
  // Dados do Cliente
  cliente         String
  telefone        String?
  
  // Dados do ServiÃ§o
  servico         String
  data            String
  horario         String
  valor           Float
  
  // Status e Pagamento
  status          String   @default("PENDENTE") 
  paymentId       String?  
  metodoPagamento String?  
  
  createdAt       DateTime @default(now())

  // RELAÃ‡ÃƒO COM A LOJA
  establishmentId String?  
  establishment   Estabelecimento? @relation(fields: [establishmentId], references: [id])
}

// --- SERVIÃ‡OS ---
model Service {
  id          String  @id @default(cuid())
  
  // Detalhes
  title       String  
  description String? 
  price       Float   
  duration    Int     
  imageUrl    String? 
  
  // CONTROLE DO DONO
  active      Boolean @default(true) 
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // RELAÃ‡ÃƒO COM A LOJA
  establishmentId String?
  establishment   Estabelecimento? @relation(fields: [establishmentId], references: [id])
}

// --- NOTIFICAÃ‡Ã•ES ---
model PushSubscription {
  id        String   @id @default(cuid())
  endpoint  String   @unique
  p256dh    String
  auth      String
  createdAt DateTime @default(now())
}