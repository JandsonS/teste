generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// --- TABELA PAI (A Barbearia/Loja) ---
model Estabelecimento {
  id                String   @id @default(cuid())
  slug              String   @unique // O link da loja (ex: barbearia-vip)
  nome              String   // Nome que aparece no topo
  
  // --- FINANCEIRO & INTEGRAÇÕES ---
  mercadoPagoToken  String?  // Token específico desta loja
  
  // --- PERSONALIZAÇÃO VISUAL (Painel Admin) ---
  logoUrl            String?  // Logo da loja
  backgroundImageUrl String?  // Banner de fundo
  corPrincipal       String   @default("#acb9b5") // Cor do tema
  
  // --- CONTATO & RODAPÉ ---
  telefoneWhatsApp   String?  // Botão flutuante
  endereco           String?  // Novo: Para mostrar no rodapé
  
  // --- REGRAS DE NEGÓCIO (Configurações) ---
  porcentagemSinal   Float    @default(50.0) // 0.0 a 100.0 (Sinal dinâmico)
  horarioAbertura    String   @default("08:00")
  horarioFechamento  String   @default("20:00")
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // --- RELAÇÕES (O que pertence a esta loja) ---
  agendamentos       Agendamento[]
  servicos           Service[]
}

// --- AGENDAMENTOS ---
model Agendamento {
  id              String   @id @default(cuid())
  slug String?
  
  // Dados do Cliente
  cliente         String
  telefone        String?
  
  // Dados do Serviço
  servico         String
  data            String
  horario         String
  valor           Float
  
  // Status e Pagamento
  status          String   @default("PENDENTE") // PENDENTE, CONFIRMADO, CANCELADO
  paymentId       String?  // ID do Mercado Pago
  metodoPagamento String?  // PIX, CARTAO, etc.
  
  createdAt       DateTime @default(now())

  // RELAÇÃO COM A LOJA (Essencial para Multi-tenant)
  establishmentId String?  
  establishment   Estabelecimento? @relation(fields: [establishmentId], references: [id])
}

// --- SERVIÇOS ---
model Service {
  id          String  @id @default(cuid())
  
  // Detalhes
  title       String  // Nome do corte
  description String? // Descrição
  price       Float   // Preço
  duration    Int     // Duração em minutos
  imageUrl    String? // Foto do serviço
  
  // CONTROLE DO DONO (Ligar/Desligar serviço)
  active      Boolean @default(true) 
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // RELAÇÃO COM A LOJA (Para não misturar serviços de lojas diferentes)
  establishmentId String?
  establishment   Estabelecimento? @relation(fields: [establishmentId], references: [id])
}

// --- NOTIFICAÇÕES (Sistema Geral) ---
model PushSubscription {
  id        String   @id @default(cuid())
  endpoint  String   @unique
  p256dh    String
  auth      String
  createdAt DateTime @default(now())
}